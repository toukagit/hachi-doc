"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[889],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},l=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),l=p(n),m=r,h=l["".concat(s,".").concat(m)]||l[m]||d[m]||o;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=l;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}l.displayName="MDXCreateElement"},607:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return c},metadata:function(){return p},toc:function(){return d}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],c={title:"In-app purchase",sidebar_label:"In-app purchase",description:"",sidebar_position:3},s="In-app purchase",p={unversionedId:"IAP",id:"version-1.0.0/IAP",title:"In-app purchase",description:"",source:"@site/i18n/en/docusaurus-plugin-content-docs/version-1.0.0/IAP.md",sourceDirName:".",slug:"/IAP",permalink:"/hachi-doc/IAP",tags:[],version:"1.0.0",sidebarPosition:3,frontMatter:{title:"In-app purchase",sidebar_label:"In-app purchase",description:"",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Remote Config",permalink:"/hachi-doc/remoteConfig"},next:{title:"Account system",permalink:"/hachi-doc/login"}},u={},d=[{value:"In-app purchase access method",id:"in-app-purchase-access-method",level:2},{value:"1\u3001Import IAP plug-in",id:"1import-iap-plug-in",level:3},{value:"2\u3001Add macro definition",id:"2add-macro-definition",level:3},{value:"3\u3001Add in-store items",id:"3add-in-store-items",level:3},{value:"4\u3001Buy listening callback",id:"4buy-listening-callback",level:3},{value:"5\u3001Purchase interface",id:"5purchase-interface",level:3},{value:"6\u3001Gets the localized price string interface",id:"6gets-the-localized-price-string-interface",level:3},{value:"7\u3001Get all product information",id:"7get-all-product-information",level:3},{value:"8\u3001Get product information based on product ID",id:"8get-product-information-based-on-product-id",level:3},{value:"9\u3001The in-app purchase is abnormal",id:"9the-in-app-purchase-is-abnormal",level:3}],l={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"in-app-purchase"},"In-app purchase"),(0,o.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Need to add USE_IAP macro definition"),"   "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("a",{parentName:"strong",href:"https://docs.unity3d.com/Packages/com.unity.purchasing@4.9/manual/StoresSupported.html"},"Unity In App Purchasing plugin version 4.9.3 or higher")," (UnityEditor 2020.3+)"))))),(0,o.kt)("h2",{id:"in-app-purchase-access-method"},"In-app purchase access method"),(0,o.kt)("h3",{id:"1import-iap-plug-in"},"1\u3001Import IAP plug-in"),(0,o.kt)("p",null,"Import the Unity In App Purchasing plug-in.",(0,o.kt)("br",{parentName:"p"}),"\n","Unity menu -> Window -> Package Manager -> In App Purchasing -> Install\u3002"),(0,o.kt)("h3",{id:"2add-macro-definition"},"2\u3001Add macro definition"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},"USE_IAP \n")),(0,o.kt)("h3",{id:"3add-in-store-items"},"3\u3001Add in-store items"),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"  Two adding methods are supported:",(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("strong",{parentName:"p"},"a. Pre-set the product ID in IAPProducts.cs"),(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("strong",{parentName:"p"},"b. Add the product ID through the AddProducts interface")),"  ",(0,o.kt)("font",{color:"ff0000"}," Note: The added product type must be the same as the background application type, otherwise the corresponding product information may not be requested.")," ",(0,o.kt)("br",null),"ProductType.NonConsumable  It can only be purchased once. Good for one-time purchases, such as extra levels ProductType.Consumable     Can be purchased repeatedly. Suitable for consumable goods such as virtual currency ProductType.Subscription   Can be purchased and restored repeatedly. Durable goods, but for a limited period (subscription)")),(0,o.kt)("p",null,"a. Pre-set the item ID in ",(0,o.kt)("strong",{parentName:"p"},"HCPurchaseProducts.cs")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'public static class HCPurchaseProducts\n{\n    /// <summary>\n    /// Unadvertised product ID(product ID unified lowercase)\n    /// </summary>\n    public const string NoAds = "test.removeads";\n\n    public readonly static Dictionary<string, ProductType> ProductDic = new Dictionary<string, ProductType>()\n    {    \n         // ProductType.NonConsumable  It can only be purchased once. Good for one-time purchases, such as extra levels\n         // ProductType.Consumable     Can be purchased repeatedly. Suitable for consumable goods such as virtual currency\n         // ProductType.Subscription   Can be purchased and restored repeatedly. Durable goods, but for a limited period (subscription)\n        { NoAds, ProductType.NonConsumable},\n        //Add more product\n        ...\n        ...\n    };\n}\n')),(0,o.kt)("p",null,"b. By ",(0,o.kt)("strong",{parentName:"p"}," HCSDKManager. Instance. AddProducts add commodity ID ")," interface"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'Dictionary<string, ProductType> ProductDic = new Dictionary<string, ProductType>()\n{\n    { "com.tkkk.unitysdk.demo.1",ProductType.Consumable},\n    { "com.tkkk.unitysdk.demo.a1",ProductType.Consumable},\n    { "com.tkkk.unitysdk.demo.a12",ProductType.Consumable}\n};\n\nHCSDKManager.Instance.AddProducts(ProductDic);\n')),(0,o.kt)("h3",{id:"4buy-listening-callback"},"4\u3001Buy listening callback"),(0,o.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Payment callbacks must be set before SDK initialization")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"The payment callback is an asynchronous callback, and when the callback is returned, ensure that the game reward is issued normally. It is suggested that the game side can add a mask to shield user actions during the payment process"),"   ")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},"void Start()\n{\n    // Set the purchase listening callback\n    HCSDKManager.Instance.SetOnPurchaseDone(PurchaseCallback);\n}\n\n/// Apple/Google Pay order number\n/// Custom product name on the game side\n/// The product ID of the payment\n/// Successful payment or not\n/// Game extension field\nprivate void PurchaseCallback(string orderID, string productName, string productID, bool purchaseResult, string gameExtra)\n{\n    if (purchaseResult)\n    {\n        //Successful purchase\n    }\n    else\n    {\n        //Purchase failed\n    }\n}\n")),(0,o.kt)("h3",{id:"5purchase-interface"},"5\u3001Purchase interface"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'public void BuyProduct()\n{\n    string productID = "com.tkkk.unitysdk.demo.a1";\n    string productName = "a1";\n    string gameExtra = "a1GameExtraParam";\n    HCSDKManager.Instance.BuyProductByID(productID,productName,gameExtra);\n}\n')),(0,o.kt)("h3",{id:"6gets-the-localized-price-string-interface"},"6\u3001Gets the localized price string interface"),(0,o.kt)("p",null,"Returns a price string with a currency symbol, such as '$1.99' '\uffe56.99'."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},"public void GetPriceByID()\n{\n    string productID = \"com.tkkk.unitysdk.demo.a1\";\n   \n    // Returns a price string with a currency symbol, such as '$1.99' '\uffe56.99'.\n    string price = HCSDKManager.Instance.GetPriceByID(productID);\n}\n")),(0,o.kt)("h3",{id:"7get-all-product-information"},"7\u3001Get all product information"),(0,o.kt)("p",null,"Return all configured items on AppStore/Google Play."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},"void Start()\n{\n    HCSDKManager.Instance.OnGetProductsInfo(OnProductInfoCallback);\n}\n\n public void OnProductInfoCallback(Product[] products)\n {\n    /// ex:\n    ///     products[0].metadata.localizedTitle\n    ///     products[0].metadata.localizedPriceString\n    ///     products[0].metadata.localizedDescription\n    ///     products[0].metadata.isoCurrencyCode\n } \n")),(0,o.kt)("h3",{id:"8get-product-information-based-on-product-id"},"8\u3001Get product information based on product ID"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'string productID = "com.tkkk.unitysdk.demo.a1";\n\nProduct prodyct = HCSDKManager.Instance.GetProductInfoByID(productID);\n')),(0,o.kt)("h3",{id:"9the-in-app-purchase-is-abnormal"},"9\u3001The in-app purchase is abnormal"),(0,o.kt)("p",null,"In case of payment failure, please confirm the following issues:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Payment callbacks must be set before SDK initialization"),(0,o.kt)("li",{parentName:"ul"},"All product categories must be consistent with the background configuration, consumables, non-consumables or subscription products"),(0,o.kt)("li",{parentName:"ul"},"GooglePlay China account cannot be adjusted to pay, you need to switch regions or use another region account"),(0,o.kt)("li",{parentName:"ul"},"Attempts to switch between different vpn nodes due to network reasons")))}m.isMDXComponent=!0}}]);